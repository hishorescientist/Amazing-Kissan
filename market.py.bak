import streamlit as st
from datetime import datetime
import streamlit as st

def open_external(label, url, key=None):
    js = f"window.open('{url}', '_blank');"
    st.markdown(
        f"""
        <button onclick="{js}" style="
            background-color:#2E8B57;
            color:white;
            padding:10px 20px;
            border:none;
            border-radius:8px;
            cursor:pointer;
            width:100%;
            font-size:16px;
        ">{label}</button>
        """,
        unsafe_allow_html=True
    )
def app():
    """Agricultural Market Integration Page"""
    st.title("🌾 Agricultural Marketplace Hub")
    st.caption("Find and compare the best platforms to buy and sell agricultural products online.")

    # Require login first
    if not st.session_state.get("logged_in", False):
        st.warning("⚠️ Please login to access the market hub.")
        st.stop()

    user = st.session_state.get("user", {})
    st.success(f"👋 Welcome, {user.get('username', 'Farmer')}!")

    st.markdown("---")
    st.subheader("🛒 Partnered Marketplaces")

    # Grid layout for site cards
    col1, col2 = st.columns(2)

    with col1:
        st.image("https://upload.wikimedia.org/wikipedia/commons/a/a9/Amazon_logo.svg", width=120)
        st.markdown("**Amazon Agriculture Section**")
        st.write("Buy fertilizers, seeds, tools, and farm essentials directly from Amazon.")
        open_external("Visit Amazon", "https://www.amazon.in/s?k=agriculture+products")
        st.image("https://upload.wikimedia.org/wikipedia/commons/1/1f/Flipkart_logo.png", width=120)
        st.markdown("**Flipkart Agri Store**")
        st.write("Explore a wide range of farming equipment and seeds at competitive prices.")
        open_external("Visit Flipkart", "https://www.flipkart.com/search?q=agriculture+products")

    with col2:
        st.image("https://upload.wikimedia.org/wikipedia/commons/b/bf/Bigbasket_logo.png", width=120)
        st.markdown("**BigBasket Farmers Market**")
        st.write("Sell your organic produce directly to BigBasket’s supply network.")
        if st.button("Visit BigBasket", key="bigbasket", use_container_width=True):
            st.markdown(
                "<meta http-equiv='refresh' content='0; url=https://www.bigbasket.com/cl/fruits-vegetables/'>",
                unsafe_allow_html=True,
            )

        st.image("https://upload.wikimedia.org/wikipedia/en/4/4d/Agribazaar_logo.png", width=120)
        st.markdown("**AgriBazaar Official**")
        st.write("India’s top B2B marketplace for grains, pulses, and agri-commodities.")
        if st.button("Visit AgriBazaar", key="agribazaar", use_container_width=True):
            st.markdown(
                "<meta http-equiv='refresh' content='0; url=https://www.agribazaar.com/'>",
                unsafe_allow_html=True,
            )

    st.markdown("---")
    st.subheader("🌍 Featured Categories")
    st.markdown("""
    - 🌱 Seeds & Fertilizers  
    - 🚜 Farm Machinery  
    - 🍅 Organic Produce  
    - 🐄 Animal Feed & Dairy Supplies  
    - 💧 Irrigation & Tools
    """)

    st.info("💡 Tip: Use these trusted platforms to compare prices and availability for your agricultural needs.")
    st.caption(f"Last updated: {datetime.now().strftime('%Y-%m-%d %H:%M')}")