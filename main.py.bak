# main.py
import streamlit as st
from login import app as login_page
from profile import app as profile_page
from ai_assistant import app as ai_page
from home import app as home_page
from about import app as about_page
from contact import app as contact_page

# ------------------- PAGE CONFIG -------------------
st.set_page_config(
    page_title="Amazing Kissan",
    page_icon="🌾",
    layout="wide",
    initial_sidebar_state="expanded"
)

# ------------------- SESSION DEFAULTS -------------------
if "page" not in st.session_state:
    st.session_state.page = "Home"
if "logged_in" not in st.session_state:
    st.session_state.logged_in = False
if "user" not in st.session_state:
    st.session_state.user = None

# ------------------- SIDEBAR -------------------
with st.sidebar:
    st.title("Amazing Kissan 🌾")
    
    page = st.radio(
        "Navigation",
        ["Home", "AI Assistant", "Profile", "About", "Contact"],
        index=["Home", "AI Assistant", "Profile", "About", "Contact"].index(st.session_state.page)
    )

    if page != st.session_state.page:
        st.session_state.page = page
        st.experimental_rerun()
    
    if st.session_state.get("logged_in"):
        st.info(f"👤 Logged in as: {st.session_state.user['username']}")
        if st.button("Logout"):
            for key in ["logged_in", "user", "current_topic", "ai_history", "user_chats", "guest_chats"]:
                if key in st.session_state:
                    del st.session_state[key]
            st.success("✅ You have been logged out")
            st.experimental_rerun()
    else:
        st.info("Please log in to access all features")
        if st.button("Login"):
            st.session_state.page = "Login"
            st.experimental_rerun()

# ------------------- PAGE ROUTING -------------------
if st.session_state.page == "Home":
    home_page()
elif st.session_state.page == "AI Assistant":
    ai_page()
elif st.session_state.page == "Profile":
    if st.session_state.get("logged_in"):
        profile_page()
    else:
        st.warning("⚠️ Please log in to view your profile")
elif st.session_state.page == "About":
    about_page()
elif st.session_state.page == "Contact":
    contact_page()
elif st.session_state.page == "Login":
    login_page()